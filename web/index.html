<html>
    <head>
        <title>VPN Check: %STATUS%: %IPADDR%</title>
    </head>
    <body>
        <h2>VPN Check: %STATUS%</h2>
        <p>
            IP Address:
            <strong
                ><a href="https://ipgeolocation.io/what-is-my-ip/%IPADDR%"
                    >%IPADDR%</a
                >
            </strong>
        </p>
        <p>Original IP Address: %ORIGADDR%</p>
        <p>As of: %NOW%</p>
        <div id="ipinfo-details">
            <h3>IP Info Details</h3>
            <table
                id="ipinfo-table"
                border="1"
                style="border-collapse: collapse; display: none"
            >
                <tbody>
                    <tr>
                        <th>Field</th>
                        <th>Value</th>
                    </tr>
                </tbody>
            </table>
            <div id="ipinfo-error" style="color: red; display: none">
                Failed to load /ipinfo.json
            </div>
        </div>
        <div>
            API Endpoints, refreshed every 10 seconds:
            <ul>
                <li><a href="status.json">status.json</a></li>
                <li><a href="ipinfo.json">ipinfo.json</a></li>
            </ul>
        </div>
        <script>
            fetch("/ipinfo.json")
                .then((response) => {
                    if (!response.ok)
                        throw new Error("Could not fetch /ipinfo.json");
                    return response.json();
                })
                .then((data) => {
                    const table = document.getElementById("ipinfo-table");
                    const tbody = table.querySelector("tbody");
                    // Remove all rows except the header
                    while (tbody.rows.length > 1) {
                        tbody.deleteRow(1);
                    }
                    Object.entries(data).forEach(([key, value]) => {
                        if (key != "readme") {
                            const row = document.createElement("tr");
                            const keyCell = document.createElement("td");
                            keyCell.textContent = key;
                            const valueCell = document.createElement("td");
                            valueCell.textContent = value;
                            row.appendChild(keyCell);
                            row.appendChild(valueCell);
                            tbody.appendChild(row);
                        }
                    });
                    table.style.display = "";
                })
                .catch((error) => {
                    document.getElementById("ipinfo-error").style.display = "";
                });
        </script>
    </body>
</html>
